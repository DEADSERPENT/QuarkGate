# ============================================================
#  GraphQL Gateway Service - Configuration
# ============================================================

# --- Server ---
quarkus.http.port=8080
quarkus.application.name=graphql-gateway

# --- GraphQL ---
quarkus.smallrye-graphql.ui.always-include=true
quarkus.smallrye-graphql.schema-include-directives=true

# --- CORS (for React frontend at localhost:5173) ---
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:5173
quarkus.http.cors.methods=GET,POST,OPTIONS
quarkus.http.cors.headers=Content-Type,Accept,Authorization

# --- REST Client: User Service ---
quarkus.rest-client.user-api.url=http://localhost:8081
quarkus.rest-client.user-api.scope=jakarta.inject.Singleton
quarkus.rest-client.user-api.connect-timeout=2000
quarkus.rest-client.user-api.read-timeout=5000

# --- REST Client: Product Service ---
quarkus.rest-client.product-api.url=http://localhost:8082
quarkus.rest-client.product-api.scope=jakarta.inject.Singleton
quarkus.rest-client.product-api.connect-timeout=2000
quarkus.rest-client.product-api.read-timeout=5000

# --- REST Client: Order Service ---
quarkus.rest-client.order-api.url=http://localhost:8083
quarkus.rest-client.order-api.scope=jakarta.inject.Singleton
quarkus.rest-client.order-api.connect-timeout=2000
quarkus.rest-client.order-api.read-timeout=5000

# --- REST Client: Payment Service ---
quarkus.rest-client.payment-api.url=http://localhost:8084
quarkus.rest-client.payment-api.scope=jakarta.inject.Singleton
quarkus.rest-client.payment-api.connect-timeout=2000
quarkus.rest-client.payment-api.read-timeout=5000

# --- Redis Cache ---
quarkus.redis.hosts=redis://localhost:6379
quarkus.cache.type=redis
quarkus.cache.redis."products-cache".ttl=60S
quarkus.cache.redis."product-cache".ttl=120S
quarkus.cache.redis."users-cache".ttl=60S
quarkus.cache.redis."user-cache".ttl=120S

# --- Health & Metrics ---
quarkus.health.extensions.enabled=true
quarkus.micrometer.export.prometheus.enabled=true

# --- OpenTelemetry (Distributed Tracing) ---
quarkus.otel.exporter.otlp.traces.endpoint=http://localhost:4317
quarkus.otel.service.name=graphql-gateway
quarkus.otel.traces.sampler=always_on

# --- OIDC (Keycloak) ---
quarkus.oidc.auth-server-url=http://localhost:8180/realms/quarkgate
quarkus.oidc.client-id=graphql-gateway
quarkus.oidc.application-type=service
quarkus.oidc.tls.verification=none
quarkus.oidc.token.issuer=any

# Allow the gateway to start even if Keycloak is not yet available
quarkus.oidc.connection-delay=30S

# --- HTTP Auth Policies ---
# Public: GraphQL, health, metrics, GraphQL-UI
quarkus.http.auth.permission.public.paths=/graphql,/graphql/*,/q/*,/graphql-ui/*
quarkus.http.auth.permission.public.policy=permit
# Default: permit all (individual resolvers can enforce auth via @RolesAllowed)
quarkus.http.auth.permission.default.paths=/*
quarkus.http.auth.permission.default.policy=permit

# --- Logging ---
quarkus.log.level=INFO
quarkus.log.category."org.acme".level=DEBUG
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# --- Docker (for container builds) ---
quarkus.container-image.group=acme
quarkus.container-image.name=graphql-gateway
quarkus.container-image.tag=latest

# ============================================================
#  Profile-specific overrides for Docker Compose
# ============================================================
%docker.quarkus.rest-client.user-api.url=http://user-service:8081
%docker.quarkus.rest-client.product-api.url=http://product-service:8082
%docker.quarkus.rest-client.order-api.url=http://order-service:8083
%docker.quarkus.rest-client.payment-api.url=http://payment-service:8084
%docker.quarkus.redis.hosts=redis://redis:6379
%docker.quarkus.otel.exporter.otlp.traces.endpoint=http://jaeger:4317
%docker.quarkus.oidc.auth-server-url=http://keycloak:8180/realms/quarkgate
